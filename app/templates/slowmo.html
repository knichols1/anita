{% extends "base.html" %} {% block head %} {{ super() }}
<link href="{{ url_for('static', filename='inspinia/css/plugins/footable/footable.core.css') }}" rel="stylesheet"> {% endblock %} {% block page_content %}
<div class="wrapper wrapper-content">
    <div class="row">
        <!-- <div class="col-lg-12 clearfix">
    		<button id='next' class="btn btn-primary dim" style="float: right; margin-right:100px;" type="button">Next event</button>
    		<button id='prev' class="btn btn-primary dim" style="float: right" type="button">Prev event</button>
    	</div> -->
        <div class="col-lg-7">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class='row'>
                            <div class='col-lg-6'>
                                <h5>rfpower</h5>
                                <table data-sort="false" class="footable" data-page-size="20" id='rfpower' style="width:100%">
                                    <tbody>
                                        <tr>
                                            <td>surf</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                            <td>8</td>
                                            <td>9</td>
                                            <td>10</td>
                                            <td>11</td>
                                            <td>12</td>
                                        </tr>
                                        <tr>
                                            <td>chan 1</td>
                                            <td id='rfpower_0_0'></td>
                                            <td id='rfpower_0_1'></td>
                                            <td id='rfpower_0_2'></td>
                                            <td id='rfpower_0_3'></td>
                                            <td id='rfpower_0_4'></td>
                                            <td id='rfpower_0_5'></td>
                                            <td id='rfpower_0_6'></td>
                                            <td id='rfpower_0_7'></td>
                                            <td id='rfpower_0_8'></td>
                                            <td id='rfpower_0_9'></td>
                                            <td id='rfpower_0_10'></td>
                                            <td id='rfpower_0_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 2</td>
                                            <td id='rfpower_1_0'></td>
                                            <td id='rfpower_1_1'></td>
                                            <td id='rfpower_1_2'></td>
                                            <td id='rfpower_1_3'></td>
                                            <td id='rfpower_1_4'></td>
                                            <td id='rfpower_1_5'></td>
                                            <td id='rfpower_1_6'></td>
                                            <td id='rfpower_1_7'></td>
                                            <td id='rfpower_1_8'></td>
                                            <td id='rfpower_1_9'></td>
                                            <td id='rfpower_1_10'></td>
                                            <td id='rfpower_1_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 3</td>
                                            <td id='rfpower_2_0'></td>
                                            <td id='rfpower_2_1'></td>
                                            <td id='rfpower_2_2'></td>
                                            <td id='rfpower_2_3'></td>
                                            <td id='rfpower_2_4'></td>
                                            <td id='rfpower_2_5'></td>
                                            <td id='rfpower_2_6'></td>
                                            <td id='rfpower_2_7'></td>
                                            <td id='rfpower_2_8'></td>
                                            <td id='rfpower_2_9'></td>
                                            <td id='rfpower_2_10'></td>
                                            <td id='rfpower_2_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 4</td>
                                            <td id='rfpower_3_0'></td>
                                            <td id='rfpower_3_1'></td>
                                            <td id='rfpower_3_2'></td>
                                            <td id='rfpower_3_3'></td>
                                            <td id='rfpower_3_4'></td>
                                            <td id='rfpower_3_5'></td>
                                            <td id='rfpower_3_6'></td>
                                            <td id='rfpower_3_7'></td>
                                            <td id='rfpower_3_8'></td>
                                            <td id='rfpower_3_9'></td>
                                            <td id='rfpower_3_10'></td>
                                            <td id='rfpower_3_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 5</td>
                                            <td id='rfpower_4_0'></td>
                                            <td id='rfpower_4_1'></td>
                                            <td id='rfpower_4_2'></td>
                                            <td id='rfpower_4_3'></td>
                                            <td id='rfpower_4_4'></td>
                                            <td id='rfpower_4_5'></td>
                                            <td id='rfpower_4_6'></td>
                                            <td id='rfpower_4_7'></td>
                                            <td id='rfpower_4_8'></td>
                                            <td id='rfpower_4_9'></td>
                                            <td id='rfpower_4_10'></td>
                                            <td id='rfpower_4_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 6</td>
                                            <td id='rfpower_5_0'></td>
                                            <td id='rfpower_5_1'></td>
                                            <td id='rfpower_5_2'></td>
                                            <td id='rfpower_5_3'></td>
                                            <td id='rfpower_5_4'></td>
                                            <td id='rfpower_5_5'></td>
                                            <td id='rfpower_5_6'></td>
                                            <td id='rfpower_5_7'></td>
                                            <td id='rfpower_5_8'></td>
                                            <td id='rfpower_5_9'></td>
                                            <td id='rfpower_5_10'></td>
                                            <td id='rfpower_5_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 7</td>
                                            <td id='rfpower_6_0'></td>
                                            <td id='rfpower_6_1'></td>
                                            <td id='rfpower_6_2'></td>
                                            <td id='rfpower_6_3'></td>
                                            <td id='rfpower_6_4'></td>
                                            <td id='rfpower_6_5'></td>
                                            <td id='rfpower_6_6'></td>
                                            <td id='rfpower_6_7'></td>
                                            <td id='rfpower_6_8'></td>
                                            <td id='rfpower_6_9'></td>
                                            <td id='rfpower_6_10'></td>
                                            <td id='rfpower_6_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 8</td>
                                            <td id='rfpower_7_0'></td>
                                            <td id='rfpower_7_1'></td>
                                            <td id='rfpower_7_2'></td>
                                            <td id='rfpower_7_3'></td>
                                            <td id='rfpower_7_4'></td>
                                            <td id='rfpower_7_5'></td>
                                            <td id='rfpower_7_6'></td>
                                            <td id='rfpower_7_7'></td>
                                            <td id='rfpower_7_8'></td>
                                            <td id='rfpower_7_9'></td>
                                            <td id='rfpower_7_10'></td>
                                            <td id='rfpower_7_11'></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class='col-lg-6'>
                                <h5>avgscaler</h5>
                                <table data-sort="false" class="footable" data-page-size="20" id='avgscaler' style="width:100%">
                                    <tbody>
                                        <tr>
                                            <td>surf</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                            <td>8</td>
                                            <td>9</td>
                                            <td>10</td>
                                            <td>11</td>
                                            <td>12</td>
                                        </tr>
                                        <tr>
                                            <td>chan 1</td>
                                            <td id='avgscaler_0_0'></td>
                                            <td id='avgscaler_0_1'></td>
                                            <td id='avgscaler_0_2'></td>
                                            <td id='avgscaler_0_3'></td>
                                            <td id='avgscaler_0_4'></td>
                                            <td id='avgscaler_0_5'></td>
                                            <td id='avgscaler_0_6'></td>
                                            <td id='avgscaler_0_7'></td>
                                            <td id='avgscaler_0_8'></td>
                                            <td id='avgscaler_0_9'></td>
                                            <td id='avgscaler_0_10'></td>
                                            <td id='avgscaler_0_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 2</td>
                                            <td id='avgscaler_1_0'></td>
                                            <td id='avgscaler_1_1'></td>
                                            <td id='avgscaler_1_2'></td>
                                            <td id='avgscaler_1_3'></td>
                                            <td id='avgscaler_1_4'></td>
                                            <td id='avgscaler_1_5'></td>
                                            <td id='avgscaler_1_6'></td>
                                            <td id='avgscaler_1_7'></td>
                                            <td id='avgscaler_1_8'></td>
                                            <td id='avgscaler_1_9'></td>
                                            <td id='avgscaler_1_10'></td>
                                            <td id='avgscaler_1_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 3</td>
                                            <td id='avgscaler_2_0'></td>
                                            <td id='avgscaler_2_1'></td>
                                            <td id='avgscaler_2_2'></td>
                                            <td id='avgscaler_2_3'></td>
                                            <td id='avgscaler_2_4'></td>
                                            <td id='avgscaler_2_5'></td>
                                            <td id='avgscaler_2_6'></td>
                                            <td id='avgscaler_2_7'></td>
                                            <td id='avgscaler_2_8'></td>
                                            <td id='avgscaler_2_9'></td>
                                            <td id='avgscaler_2_10'></td>
                                            <td id='avgscaler_2_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 4</td>
                                            <td id='avgscaler_3_0'></td>
                                            <td id='avgscaler_3_1'></td>
                                            <td id='avgscaler_3_2'></td>
                                            <td id='avgscaler_3_3'></td>
                                            <td id='avgscaler_3_4'></td>
                                            <td id='avgscaler_3_5'></td>
                                            <td id='avgscaler_3_6'></td>
                                            <td id='avgscaler_3_7'></td>
                                            <td id='avgscaler_3_8'></td>
                                            <td id='avgscaler_3_9'></td>
                                            <td id='avgscaler_3_10'></td>
                                            <td id='avgscaler_3_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 5</td>
                                            <td id='avgscaler_4_0'></td>
                                            <td id='avgscaler_4_1'></td>
                                            <td id='avgscaler_4_2'></td>
                                            <td id='avgscaler_4_3'></td>
                                            <td id='avgscaler_4_4'></td>
                                            <td id='avgscaler_4_5'></td>
                                            <td id='avgscaler_4_6'></td>
                                            <td id='avgscaler_4_7'></td>
                                            <td id='avgscaler_4_8'></td>
                                            <td id='avgscaler_4_9'></td>
                                            <td id='avgscaler_4_10'></td>
                                            <td id='avgscaler_4_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 6</td>
                                            <td id='avgscaler_5_0'></td>
                                            <td id='avgscaler_5_1'></td>
                                            <td id='avgscaler_5_2'></td>
                                            <td id='avgscaler_5_3'></td>
                                            <td id='avgscaler_5_4'></td>
                                            <td id='avgscaler_5_5'></td>
                                            <td id='avgscaler_5_6'></td>
                                            <td id='avgscaler_5_7'></td>
                                            <td id='avgscaler_5_8'></td>
                                            <td id='avgscaler_5_9'></td>
                                            <td id='avgscaler_5_10'></td>
                                            <td id='avgscaler_5_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 7</td>
                                            <td id='avgscaler_6_0'></td>
                                            <td id='avgscaler_6_1'></td>
                                            <td id='avgscaler_6_2'></td>
                                            <td id='avgscaler_6_3'></td>
                                            <td id='avgscaler_6_4'></td>
                                            <td id='avgscaler_6_5'></td>
                                            <td id='avgscaler_6_6'></td>
                                            <td id='avgscaler_6_7'></td>
                                            <td id='avgscaler_6_8'></td>
                                            <td id='avgscaler_6_9'></td>
                                            <td id='avgscaler_6_10'></td>
                                            <td id='avgscaler_6_11'></td>
                                        </tr>
                                        <tr>
                                            <td>chan 8</td>
                                            <td id='avgscaler_7_0'></td>
                                            <td id='avgscaler_7_1'></td>
                                            <td id='avgscaler_7_2'></td>
                                            <td id='avgscaler_7_3'></td>
                                            <td id='avgscaler_7_4'></td>
                                            <td id='avgscaler_7_5'></td>
                                            <td id='avgscaler_7_6'></td>
                                            <td id='avgscaler_7_7'></td>
                                            <td id='avgscaler_7_8'></td>
                                            <td id='avgscaler_7_9'></td>
                                            <td id='avgscaler_7_10'></td>
                                            <td id='avgscaler_7_11'></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-lg-5">
            <div class="col-xs-6 col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>slow</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <table data-sort="false" class="footable" data-page-size="20" id='slow' style="width:100%">
                            <tbody>
                                <tr>
                                    <td>Index:</td>
                                    <td id='index'></td>
                                </tr>
                                <tr>
                                    <td>time</td>
                                    <td id='time'></td>
                                </tr>
                                <tr>
                                    <td>now</td>
                                    <td id='now'></td>
                                </tr>
                                <tr>
                                    <td>evnum</td>
                                    <td id='evnum'></td>
                                </tr>
                                <tr>
                                    <td>latitude</td>
                                    <td id='latitude'></td>
                                </tr>
                                <tr>
                                    <td>longitude</td>
                                    <td id='longitude'></td>
                                </tr>
                                <tr>
                                    <td>altitude</td>
                                    <td id='altitude'></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Extra Info</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <table data-sort="false" class="footable" data-page-size="20" id='extra_info' style="width:100%">
                            <tbody>
                                <tr>
                                    <td></td>
                                    <td id='rate1'></td>
                                    <td id='rate10'></td>
                                    <td id='ppvv'></td>
                                    <td id='p24v'></td>
                                    <td id='bati'></td>
                                    <td id='p24i'></td>
                                    <td id='temp_0'></td>
                                    <td id='temp_1'></td>
                                    <td id='temp_2'></td>
                                    <td id='temp_3'></td>
                                </tr>
                                <tr>
                                    <td>Ev Rate[Hz]</td>
                                    <td>1min</td>
                                    <td>10min</td>
                                    <td>PV (V)</td>
                                    <td>24 V</td>
                                    <td>PV I</td>
                                    <td>24 I</td>
                                    <td>sbs [C]</td>
                                    <td>surf [C]</td>
                                    <td>turf [C]</td>
                                    <td>rad [C]</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="dialog" class='hide'>
    <div id='chart1'></div>
        </br>
        <div class="col-sm-6">
            <div class="form-group">
                <label>Reference UTC</label>
                <input id="reference_time" placeholder="Enter your end time" class="form-control">
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-group">
                <label>Length(s)</label>
                <input id="length" value="10000" placeholder="Enter the number of seconds" class="form-control">
            </div>
        </div>
        <div class="col-sm-3">
            </br>
            <button id="request" type="button" class="btn btn-primary">Request</button>
        </div>
    </div>
</div>
        {% endblock %} {% block scripts %} {{ super() }}
        <script src="{{ url_for('static', filename='inspinia/js/plugins/footable/footable.all.min.js') }}"></script>
        <script src="{{ url_for('static', filename='inspinia/js/plugins/sparkline/jquery.sparkline.min.js') }}"></script>
        <script>
        var slow_nbufs = [];
        var slow_nows = [];
        var slow_times = [];
        var i = 0;
        var connected = false;
        var offset = 0;
        var sleep_interval = 2000 //by default, re-access the database every 2seconds to see if there are any new data comes in.
        function timeConverter(UNIX_timestamp) {
            var a = new Date(UNIX_timestamp * 1000);
            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            var year = a.getUTCFullYear();
            var month = months[a.getUTCMonth()];
            var date = a.getUTCDate();
            var hour = a.getUTCHours();
            var min = a.getUTCMinutes();
            var sec = a.getUTCSeconds();
            if (parseInt(min) < 10){
                min = '0' + min;
            }
            if (parseInt(sec) < 10){
                sec = '0' + sec;
            }
            var time = month + ' ' + date + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
            return time;
        }
        var rfpower_range_map = $.range_map({
            '0:6600': 'blue',
            '6600:13300': 'green',
            '13300:25000:': 'red'
        })
        var avgscaler_range_map = $.range_map({
            '5:6': 'green',
            '6:7.5:': 'red',
            '4:5:': 'red'
        })
        var rate_range_map = $.range_map({
            '30:60': 'green',
            '20:30:': 'yelow',
            '60:70:': 'yellow'
        })
        var ppvv_range_map = $.range_map({
            '47:61': 'green'
        })

        var p24v_range_map = $.range_map({
            '23.6:30.6': 'green'
        })

        var bati_range_map = $.range_map({
            '7:11': 'green'
        })

        var p24i_range_map = $.range_map({
            '13.4:19': 'green'
        })

        var temperature_range_map = $.range_map({
            '-50:0': 'blue',
            '0:50:': 'green',
            '50:70:': 'yellow'
        })

        function update_avgscaler_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: avgscaler_range_map,
                chartRangeMin: 0,
                chartRangeMax: 8
            });
        }

        function update_rate1_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: rate_range_map,
                chartRangeMin: 0,
                chartRangeMax: 100
            });
        }

        function update_rate10_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: rate_range_map,
                chartRangeMin: 0,
                chartRangeMax: 100
            });
        }

        function update_ppvv_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: ppvv_range_map,
                chartRangeMin: 0,
                chartRangeMax: 75
            });
        }

        function update_p24v_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: p24v_range_map,
                chartRangeMin: 0,
                chartRangeMax: 75
            });
        }

        function update_bati_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: bati_range_map,
                chartRangeMin: 0,
                chartRangeMax: 30
            });
        }

        function update_p24i_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                // zeroAxis: false,
                colorMap: p24i_range_map,
                chartRangeMin: 0,
                chartRangeMax: 30
            });
        }

        function update_temp_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                zeroAxis: false,
                colorMap: temperature_range_map,
                chartRangeMin: -80,
                chartRangeMax: 80
            });
        }

        function update_rfpower_data($selector, new_data) {
            var array_string = $selector.attr('values');
            array_string = new_data;
            // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
            $selector.attr('values', array_string).sparkline('html', {
                type: 'bar',
                barWidth: 10,
                height : 90,
                colorMap: rfpower_range_map,
                chartRangeMin: 0,
                chartRangeMax: 25000
            });
        }

        function updatehtml(slow_times) {
            $.getJSON('/api/' + ip_db + '/slow/' + slow_times, function(data) {
                $('#slow #index').html(i + 1 + "/" + slow_nbufs.length);
                $('#slow #now').html(data.slow.now + " (" + timeConverter(data.slow.now) + ")");
                $('#slow #time').html(data.slow.time + " (" + timeConverter(data.slow.time) + ")");
                $('#slow #evnum').html(data.slow.evnum);
                $('#slow #latitude').html(data.slow.latitude);
                $('#slow #longitude').html(data.slow.longitude);
                $('#slow #altitude').html(data.slow.altitude);


                var rfpower_name;
                for (var ii = 0; ii < 8; ii++) {
                    for (var jj = 0; jj < 12; jj++) {
                        rfpower_name = '#rfpower_' + ii + '_' + jj;
                        update_rfpower_data($(rfpower_name), parseInt(data.slow.avgrfpow[jj][ii]));
                    }
                }

                var avgscaler_name;
                for (var ii = 0; ii < 8; ii++) {
                    for (var jj = 0; jj < 12; jj++) {
                        avgscaler_name = '#avgscaler_' + ii + '_' + jj;
                        update_avgscaler_data($(avgscaler_name), Math.log(1 + parseInt(data.slow.avgscaler[ii][jj])));
                    }
                }

                var rate1_name;
                rate1_name = '#rate1';
                update_rate1_data($(rate1_name), parseInt(data.slow.rate1));

                var rate10_name;
                rate10_name = '#rate10';
                update_rate10_data($(rate10_name), parseInt(data.slow.rate10));


                var ppvv_name;
                ppvv_name = '#ppvv';
                update_ppvv_data($(ppvv_name), parseInt(data.slow.ppvv));

                var p24v_name;
                p24v_name = '#p24v';
                update_p24v_data($(p24v_name), parseInt(data.slow.p24v));

                var bati_name;
                bati_name = '#bati';
                update_bati_data($(bati_name), parseInt(data.slow.bati));

                var p24i_name;
                p24i_name = '#p24i';
                update_p24i_data($(p24i_name), parseInt(data.slow.p24i));


                var temp_name;
                for (var ii = 0; ii < 4; ii++) {
                    temp_name = '#temp_' + ii;
                    update_temp_data($(temp_name), parseInt(data.slow.temp[ii]));
                }
            });
        }

$(document).ready(function() {
    $('#navbar_slow').parent().addClass("active");
    $.jqplot.config.enablePlugins = true;
    $("td[id]").click(function() {
        var column_name = $(this).attr('id');
        var table_name = $(this).closest('.ibox').attr('id');
        var name = table_name + '_' + column_name;
        // console.log($(this).attr('id'));
        // console.log($(this).closest('.ibox').attr('id'));
        if ($("#dialog_" + name).length) {
            $("#dialog_" + name).dialog('open');
            $("#dialog_" + name).find('input[id="reference_time"]').val(slow_times[i]);
        } else {
            var $newDialog = $('#dialog').clone();
            $newDialog.attr('id', 'dialog_' + name);
            $newDialog.removeClass('hide');
            $newDialog.attr('title', name);
            $newDialog.prepend('<div id="' + "plot_" + name + '"></div>');
            $newDialog.find('input[id="reference_time"]').val(slow_times[i]);
            $newDialog.dialog({
                width: 600,
                height: 500,
            });
            var line1 = [
            ['2008-09-30', 14]
            ];
            var plot1 = $.jqplot('plot_' + name, [line1], {
                title: 'double click to reset the zoom',
                axes: {
                    xaxis: {
                        renderer: $.jqplot.DateAxisRenderer,
                        rendererOptions: {
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer
                        },
                        tickOptions: {
                            // formatString: '%M:%S%#N ',
                            fontSize: '10pt',
                            fontFamily: 'Tahoma',
                        }
                    },
                    yaxis: {
                        rendererOptions: {
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer
                        },
                        tickOptions: {
                            fontSize: '10pt',
                            fontFamily: 'Tahoma',
                        }
                    }
                },
                series: [{
                    lineWidth: 2
                }],
                cursor: {
                    zoom: true,
                    looseZoom: true,
                    // showTooltip:true, 
                    followMouse: true,
                    showTooltipOutsideZoom: true,
                    constrainOutsideZoom: false
                }
            });

            $newDialog.dialog({
                resize: function(event, ui) {
                    $("#plot_" + name).height(Math.max(100, $newDialog.height() - 120));
                    plot1.replot({
                        resetAxes: true,
                    });
                }
            });
        }

        $("#dialog_" + name).find('button[id="request"]').click(function() {
            console.log('click');
            var end_time = $newDialog.find('input[id="reference_time"]').val();
            var length = $newDialog.find('input[id="length"]').val();
            // console.log(end_time);
            // console.log(end_time - length);
            $.getJSON('/api/' + ip_db + '/history/' + 'slow' + '/' + column_name + '/' + (end_time - length) + '/' + end_time, function(data) {
                // console.log(data.data);
                plot1.replot({
                    data: [data.data]
                });
            });
        });

        $("#dialog_" + name).find('button[id="request"]').trigger("click");
    });
            
    $('#label_sync_checkbox').attr('style', 'display:none');
    $('#sync_checkbox').attr('style', 'display:none');
    $('.footable').footable();
    
        // $.getJSON('/api/' + ip_db + '/slow/times', function(data){
        // 	slow_nbufs=data.slow_nbufs;
        // 	slow_nows=data.slow_nows;
        // 	slow_times=data.slow_times;
        // });
    function autoload() {
        $.getJSON('/api/' + ip_db + '/slow/times/' + offset, function(data) {
            new_length = data.slow_times.length;
            offset += new_length;
            slow_nbufs = slow_nbufs.concat(data.slow_nbufs);
            slow_nows = slow_nows.concat(data.slow_nows);
            slow_times = slow_times.concat(data.slow_times);
            $('#connect').removeClass('connect').removeClass('btn-primary').addClass('btn-warning');
            $('#connect').html('Disconnect');
            $('.chosen-select').attr("disabled", true).trigger("chosen:updated");
            // switchery.enable();
            connected = true;
            connect.ladda('stop');
        }).done(function() {
            setTimeout(function() {
                if (new_length) {
                    sleep_interval = 2000;
                } else {
                    sleep_interval = Math.min(sleep_interval * 1.2, 60000);
                }
                if (connected == true) {
                    autoload();
                }
            }, sleep_interval);

        });
    }
    var connect = $('.ladda-button').ladda();
    $('#connect').click(function() {
        if ($(this).hasClass('connect')) {
            slow_nbufs = [];
            slow_nows = [];
            slow_times = [];
            i = 0;
            offset = 0;
            connect.ladda('start');
            $.ajax({
                url: '/api/connect/' + ip + '/' + db
            }).done(function(response) {
                if (response == 'success') {
                    autoload();
                    setTimeout(function(){
        			        $('#first').click();
        		        },1000);
                } else {
                    connect.ladda('stop');
                    swal({
                        title: 'Database not found!',
                        type: "warning",
                        timer: 3000,
                        showConfirmButton: true
                    });
                }
            });
        } else {
            slow_nbufs = [];
            slow_nows = [];
            slow_times = [];
            i = 0;
            offset = 0;
            //otherwise, stop all the requests.
            $('#connect').addClass('connect').addClass('btn-primary').removeClass('btn-warning');
            $('#connect').html('Connect');
            $('.chosen-select').attr("disabled", false).trigger("chosen:updated");
            // if (switchery.isChecked()){
            // 	$('.switchery').click();
            // };
            // switchery.disable();				
            connected = false;
        }
    });


    $('#next').click(function() {
        if (i < slow_times.length - 1) {
            i = i + 1;
            updatehtml(slow_times[i]);
        };
    });
    $('#prev').click(function() {
        if (i > 0) {
            i = i - 1;
            updatehtml(slow_times[i]);
        };
    });
    $('#first').click(function() {
        i = 0;
        updatehtml(slow_times[i]);
    });
    $('#last').click(function() {
        i = slow_times.length - 1;
        updatehtml(slow_times[i]);
    });
    var elem = document.querySelector('.js-switch');
    var switchery = new Switchery(elem, {
        color: '#1AB394'
    });
    // switchery.disable();
    var myInterval;
    elem.onchange = function() {
        console.log("working!!!!!!");
        if (elem.checked) {
            myInterval = setInterval(function() {
                if (i < slow_times.length - 1) {
                    i = i + 1;
                    updatehtml(slow_times[i]);
                };
            }, 1000);
        } else {
            clearInterval(myInterval);
        };
    };
    $('#goto').click(function() {
        var keywords = parseInt($('#keywords').val());
        console.log(keywords);
        var index = slow_times.indexOf(keywords);
        if (index != -1 && keywords) {
            i = index;
            console.log(i);
            updatehtml(slow_times[i]);
        } else {
            swal({
                title: 'Data not found!',
                type: "warning",
                timer: 3000,
                showConfirmButton: true
            });
        }

    });
});
</script>
{% endblock %}