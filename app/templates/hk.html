 {% extends "base.html" %} {% block head %} {{ super() }}
 <link href="{{ url_for('static', filename='inspinia/css/plugins/footable/footable.core.css') }}" rel="stylesheet"> {% endblock %} {% block page_content %}
 <div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-6">
            <div class="ibox float-e-margins" id="hk">
                <div class="ibox-title">
                    <h5>House Keeping</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="20" id='power' style="width:100%">
                        <h5>Power</h5>
                        <tbody>
                            <tr>
                                <td></td>
                                <td>Voltage [volts]</td>
                                <td>Current [Amps]</td>
                            </tr>
                            <tr>
                                <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
                            </tr>
                            <tr>
                                <td data-hide="xs">+1.5V</td>
                                <td magicbox-creator id='p1_5v'></td>
                                <td magicbox-creator id='p1_5i'></td>
                            </tr>
                            <tr>
                                <td>+3.3V</td>
                                <td id='p3_3v'></td>
                                <td id='p3_3i'></td>
                            </tr>
                            <tr>
                                <td>+5V</td>
                                <td id='p5v'></td>
                                <td id='p5i'></td>
                            </tr>
                            <tr>
                                <td>+5V Short Board</td>
                                <td id='p5sbv'></td>
                                <td id='p5sbi'></td>
                            </tr>
                            <tr>
                                <td>+12V</td>
                                <td id='p12v'></td>
                                <td id='p12i'></td>
                            </tr>
                            <tr>
                                <td>+24V</td>
                                <td id='p24v'></td>
                                <td id='p24i'></td>
                            </tr>
                            <tr>
                                <td>+PV</td>
                                <td id='ppvv'></td>
                                <td id='ppvi'></td>
                            </tr>
                            <tr>
                                <td>-5V</td>
                                <td id='n5v'></td>
                                <td id='n5i'></td>
                            </tr>
                            <tr>
                                <td>-12V</td>
                                <td id='n12v'></td>
                                <td id='n12i'></td>
                            </tr>
                            <tr>
                                <td>RFCM1</td>
                                <td id='iprf1v'></td>
                                <td id='iprf1i'></td>
                            </tr>
                            <tr>
                                <td>RFCM2</td>
                                <td id='iprf2v'></td>
                                <td id='iprf2i'></td>
                            </tr>
                            <tr>
                                <td>Battery</td>
                                <td>None</td>
                                <td id='bati'></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="56" id='temp1' style="width:100%">
                        <h5>Temperature [C]</h5>
                        <tbody>
                            <tr>
                                <td>It</td>
                                <td id='it-0'></td>
                                <td id='it-1'></td>
                                <td id='it-2'></td>
                                <td id='it-3'></td>
                                <td id='it-4'></td>
                                <td id='it-5'></td>
                                <td id='it-6'></td>
                                <td id='it-7'></td>
                                <td id='it-8'></td>
                                <td id='it-9'></td>
                                <td id='it-10'></td>
                                <td id='it-11'></td>
                                <td id='it-12'></td>
                                <td id='it-13'></td>
                                <td id='it-14'></td>
                                <td>Et</td>
                                <td id='et-0'></td>
                                <td id='et-1'></td>
                                <td id='et-2'></td>
                                <td id='et-3'></td>
                                <td id='et-4'></td>
                                <td id='et-5'></td>
                                <td id='et-6'></td>
                                <td id='et-7'></td>
                                <td id='et-8'></td>
                                <td id='et-9'></td>
                                <td id='et-10'></td>
                                <td id='et-11'></td>
                                <td id='et-12'></td>
                                <td id='et-13'></td>
                                <td id='et-14'></td>
                                <td>CPU</td>
                                <td id='sbst1'></td>
                                <td id='sbst2'></td>
                                <td id='sbst5'></td>
                                <td id='sbst6'></td>
                                <td>Core</td>
                                <td id='core1'></td>
                                <td id='core2'></td>
                            </tr>
                            <tr>
                                <td>It </td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>5</td>
                                <td>6</td>
                                <td>7</td>
                                <td>8</td>
                                <td>9</td>
                                <td>10</td>
                                <td>11</td>
                                <td>12</td>
                                <td>13</td>
                                <td>14</td>
                                <td>15</td>
                                <td>Et</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>5</td>
                                <td>6</td>
                                <td>7</td>
                                <td>8</td>
                                <td>9</td>
                                <td>10</td>
                                <td>11</td>
                                <td>12</td>
                                <td>13</td>
                                <td>14</td>
                                <td>15</td>
                                <td>CPU</td>
                                <td>1</td>
                                <td>2</td>
                                <td>5</td>
                                <td>6</td>
                                <td>Core</td>
                                <td>1</td>
                                <td>2</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="20" id='aux' style="width:100%">
                        <h5>Auxilary Information</h5>
                        <tbody>
                            <tr>
                                <td>Time</td>
                                <td id='time'></td>
                                <td>Now</td>
                                <td id='now'></td>
                            </tr>
                            <tr>
                                <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
                            </tr>
                            <tr>
                                <td>Pressure [torr]</td>
                                <td id='pressl'></td>
                                <td>Pressure [PSI]</td>
                                <td id='pressh'></td>
                            </tr>
                            <tr>
                                <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>Elevation</td>
                                <td>Azimuth</td>
                                <td>Flag</td>
                            </tr>
                            <tr>
                                <td>SunSensor 1</td>
                                <td id='ssel-0'></td>
                                <td id='ssaz-0'></td>
                                <td id='ssflag-0'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 2</td>
                                <td id='ssel-1'></td>
                                <td id='ssaz-1'></td>
                                <td id='ssflag-1'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 3</td>
                                <td id='ssel-2'></td>
                                <td id='ssaz-2'></td>
                                <td id='ssflag-2'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 4</td>
                                <td id='ssel-3'></td>
                                <td id='ssaz-3'></td>
                                <td id='ssflag-3'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 5</td>
                                <td id='ssel-4'></td>
                                <td id='ssaz-4'></td>
                                <td id='ssflag-4'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 6</td>
                                <td id='ssel-5'></td>
                                <td id='ssaz-5'></td>
                                <td id='ssflag-5'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 7</td>
                                <td id='ssel-6'></td>
                                <td id='ssaz-6'></td>
                                <td id='ssflag-6'></td>
                            </tr>
                            <tr>
                                <td>SunSensor 8</td>
                                <td id='ssel-7'></td>
                                <td id='ssaz-7'></td>
                                <td id='ssflag-7'></td>
                            </tr>
                            <tr>
                                <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
                            </tr>
                            <tr>
                                <td>Accel 1 [x,y,z]</td>
                                <td id='accx-0'></td>
                                <td id='accy-0'></td>
                                <td id='accz-0'></td>
                            </tr>
                            <tr>
                                <td>Accel 2 [x,y,z]</td>
                                <td id='accx-1'></td>
                                <td id='accy-1'></td>
                                <td id='accz-1'></td>
                            </tr>
                            <tr>
                                <td>Mag [x,y,z]</td>
                                <td id='magx'></td>
                                <td id='magy'></td>
                                <td id='magz'></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="ibox float-e-margins" id="mon">
                <div class="ibox-title">
                    <h5>Monitor</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="56" id='montimes' style="width:100%">
                        <tbody>
                            <th>
                                <td>Time:</td>
                                <td id='time'></td>
                                <td> Now:</td>
                                <td id='now'></td>
                            </th>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="20" id='query_entries' style="width:100%">
                        <h5>Queue Entries & Disk Spaces</h5>
                        <tbody>
                            <tr>
                                <td>P[i]</td>
                                <td id='linkev-0'></td>
                                <td id='linkev-1'></td>
                                <td id='linkev-2'></td>
                                <td id='linkev-3'></td>
                                <td id='linkev-4'></td>
                                <td id='linkev-5'></td>
                                <td id='linkev-6'></td>
                                <td id='linkev-7'></td>
                                <td id='linkev-8'></td>
                                <td id='linkev-9'></td>
                                <td>Other</td>
                                <td id='linkcmdlos'></td>
                                <td id='linkcmdsip'></td>
                                <td id='linkhd'></td>
                                <td id='linkgps'></td>
                                <td id='linkhk'></td>
                                <td id='linkmon'></td>
                                <td id='linksurf'></td>
                                <td id='linkturf'></td>
                                <td id='linkped'></td>
                                <td>Disk</td>
                                <td id='disk-0'></td>
                                <td id='disk-1'></td>
                                <td id='disk-2'></td>
                                <td id='disk-3'></td>
                                <td id='disk-4'></td>
                                <td id='disk-5'></td>
                                <td id='disk-6'></td>
                                <td id='disk-7'></td>
                            </tr>
                            <tr>
                                <td ></td>
                                <td>0</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>5</td>
                                <td>6</td>
                                <td>7</td>
                                <td>8</td>
                                <td>9</td>
                                <td> </td>
                                <td>cmdL</td>
                                <td>cmd5</td>
                                <td>hd</td>
                                <td>gps</td>
                                <td>hk</td>
                                <td>mon</td>
                                <td>surf</td>
                                <td>turf</td>
                                <td>ped</td>
                                <td></td>
                                <td>/temp</td>
                                <td>var</td>
                                <td>home</td>
                                <td>/DS</td>
                                <td>He1</td>
                                <td>He2</td>
                                <td>int</td>
                                <td>NTU</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="20" id='disk' style="width:100%">
                        <h5>Disk Space [MB]</h5>
                        <tbody>
                            <tr>
                                <td></td>
                                <td id='disk-0'></td>
                                <td id='disk-1'></td>
                                <td id='disk-2'></td>
                                <td id='disk-3'></td>
                                <td id='disk-4'></td>
                                <td id='disk-5'></td>
                                <td id='disk-6'></td>
                                <td id='disk-7'></td>
                            </tr>
                            <th>
                                <td>/temp</td>
                                <td>var</td>
                                <td>home</td>
                                <td>/DS</td>
                                <td>He1</td>
                                <td>He2</td>
                                <td>int</td>
                                <td>NTU</td>
                            </th>
                        </tbody>
                    </table>
                </div> -->
            </div>
        </div>

        <div class="col-lg-6">
            <div class="ibox float-e-margins" id="cmd">
                <div class="ibox-title">
                    <h5>Command</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <table data-sort="false" class="footable" data-page-size="56" style="width:100%">
                        <tbody>
                            <tr>
                                <td>Time:</td>
                                <td id='time'></td>
                                <td> Now:</td>
                                <td id='now'></td>
                            </tr>
                            <tr>
                                <td>Last comamnds:</td>
                                <td id = 'last_command'></td>
                                <td>Antennas off:</td>
                                <td id = 'antennas_off'></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    <div class="col-lg-6">
        <div class="ibox float-e-margins" id="adu5_pat">
            <div class="ibox-title">
               <h5>GPS Panel</h5>
               <div class="ibox-tools">
                   <a class="collapse-link">
                      <i class="fa fa-chevron-up"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content" >
                <table data-sort="false" class="footable" data-page-size="26" id='gps' style="width:100%">
                    <tbody>
                        <tr>
                            <td>Curret GPS:</td>                        
                            <td id='pat_gpstype'></td>
                        </tr>
                        <tr>
                            <td bgcolor="#FFFFFF" style="line-height:20px;" colspan=3>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>GPS:</td>
                            <td>adu5A</td>
                            <td>adu5B</td>
                            <td>g12</td>
                        </tr>
                        <tr>
                            <td>Full Time</td>
                            <td id='fulltime_5A'></td>
                            <td id='fulltime_5B'></td>
                            <td id='fulltime_g12'></td>
                        </tr>
                        <tr>
                            <td>Time</td>
                            <td id='time_5A'></td>
                            <td id='time_5B'></td>
                            <td id='time_g12'></td>
                        </tr>
                        <tr>
                            <td>Full Now</td>
                            <td id='fullnow_5A'></td>
                            <td id='fullnow_5B'></td>
                            <td id='fullnow_g12'></td>                                
                        </tr>
                        <tr>
                            <td>Now</td>
                            <td id='now_5A'></td>
                            <td id='now_5B'></td> 
                            <td id='now_g12'></td>                                 
                        </tr>
                        <tr>
                            <td bgcolor="#FFFFFF" style="line-height:20px;" colspan=3>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>Latitude</td>
                            <td id='latitude_5A'></td>
                            <td id='latitude_5B'></td>
                            <td id='latitude_g12'></td>
                        </tr>
                        <tr>
                            <td>Longitude</td>  
                            <td id='longitude_5A'></td>
                            <td id='longitude_5B'></td>
                            <td id='longitude_g12'></td>                              
                        </tr>
                        <tr>
                            <td>Altitude</td>
                            <td id='altitude_5A'></td>
                            <td id='altitude_5B'></td>
                            <td id='altitude_g12'></td>
                        </tr>
                        <tr>
                            <td bgcolor="#FFFFFF" style="line-height:20px;" colspan=3>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>Pitch</td>
                            <td id='pitch_5A'></td>
                            <td id='pitch_5B'></td>
                        </tr>
                        <tr>                                
                            <td>Roll</td> 
                            <td id='roll_5A'></td>
                            <td id='roll_5B'></td>
                        </tr>
                        <tr>
                            <td>Heading</td>      
                            <td id='heading_5A'></td>
                            <td id='heading_5B'></td>
                        </tr>
                        <tr>
                            <td bgcolor="#FFFFFF" style="line-height:20px;" colspan=3>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>Current GPS:</td>
                            <td id='vtg_gpstype'></td>
                        </tr>
                        <tr>                                
                            <td>knots</td>
                            <td id='vkt_5A'></td>
                            <td id='vkt_5B'></td>
                            <td id='vkt_g12'></td> 
                        </tr>

                        <tr>
                            <td>kph</td> 
                            <td id='vkph_5A'></td>
                            <td id='vkph_5B'></td>
                            <td id='vkph_g12'></td>                           
                        </tr>
                        <tr>
                            <td bgcolor="#FFFFFF" style="line-height:20px;" colspan=3>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>Current GPS:</td>
                            <td id='sat_gpstype'></td>
                        </tr>
                        <tr>
                            <td># of Sats</td>
                            <td id='numsats_5A'></td>
                            <td id='numsats_5B'></td> 
                            <td id='numsats_g12'></td>                                 
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div id="dialog" class='hide'>
    <div id='chart1'></div>
        </br>
        <div class="col-sm-6">
            <div class="form-group">
                <label>Reference UTC</label>
                <input id="reference_time" placeholder="Enter your end time" class="form-control">
            </div>
        </div>
        <div class="col-sm-3">
            <div class="form-group">
                <label>Length(s)</label>
                <input id="length" value="10000" placeholder="Enter the number of seconds" class="form-control">
            </div>
        </div>
        <div class="col-sm-3">
            </br>
            <button id="request" type="button" class="btn btn-primary">Request</button>
        </div>
    </div>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script src="{{ url_for('static', filename='inspinia/js/plugins/footable/footable.all.min.js') }}"></script>
<script src="{{ url_for('static', filename='inspinia/js/plugins/sparkline/jquery.sparkline.min.js') }}"></script>
<script>
var sync_on = false;
function timeConverter(UNIX_timestamp) {
    var a = new Date(UNIX_timestamp * 1000);
    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    var year = a.getFullYear();
    var month = months[a.getMonth()];
    var date = a.getDate();
    var hour = a.getHours();
    var min = a.getMinutes();
    var sec = a.getSeconds();
    if (parseInt(min) < 10){
        min = '0' + min;
    }
    if (parseInt(sec) < 10){
        sec = '0' + sec;
        }
    var time = month + ' ' + date + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
    return time;
}

var it_et_range_map = $.range_map({
    '0:20': 'blue',
    '20:45:': 'green',
    '45:55:': 'yellow'
})
var sbst_range_map = $.range_map({
    '0:20': 'blue',
    '20:45:': 'green',
    '45:55:': 'yellow'
})
var core_range_map = $.range_map({
    '0:30': 'blue',
    '30:60:': 'green',
    '60:80:': 'yellow'
})
var stemp_range_map = $.range_map({
    '0:4000': 'blue',
    '30:60:': 'green',
    '60:80:': 'yellow'
})
var disk0_range_map = $.range_map({
    '400:5000': 'green',
    '100:400:': 'yellow'
})
var disk1_range_map = $.range_map({
    '150:2000': 'green',
    '40:150:': 'yellow',
})
var disk2_range_map = $.range_map({
    '300:3500': 'green',
    '80:300:': 'yellow',
})
var disk3_range_map = $.range_map({
    '300:4000': 'green',
    '50:300:': 'yellow',
})
var disk4_range_map = $.range_map({
    '1000000:7000000': 'green',
    '6000:1000000:': 'yellow',
})
var disk5_range_map = $.range_map({
    '1000000:7000000': 'green',
    '6000:1000000:': 'yellow',
})
var disk6_range_map = $.range_map({
    '300:4000': 'green',
    '80:300:': 'yellow',
})
var disk7_range_map = $.range_map({
    '25000:350000': 'green',
    '2500:25000:': 'yellow',
})
var link_range_map = $.range_map({
    '0:15': 'green',
    '15:50:': 'yellow',
})

function gpstype(gpstype) {
    if (gpstype == 0x10000) {
        return 'g12';
    } else if (gpstype == 0x20000) {
        return 'adu5A';
    } else if (gpstype == 0x40000) {
        return 'adu5B';
    } else if (gpstype == 0x80000) {
        return 'cmd';
    } else {
        return 'unknown';
    };
}

function update_sbst1_data($selector, new_data) {
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: sbst_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_sbst2_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: sbst_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_sbst5_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: sbst_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_sbst6_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: sbst_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_core1_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: core_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_core2_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: core_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_it_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: it_et_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_et_data($selector, new_data) {
        var array_string = $selector.attr('values');
        array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
            height: '90',
        // zeroAxis: false,
        colorMap: it_et_range_map,
        chartRangeMin: -10,
        chartRangeMax: 100
    });
    }

    function update_disk0_data($selector, new_data) {
    //slash temp
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk0_range_map,
        chartRangeMin: 0,
        chartRangeMax: 4000
    });
    }

    function update_disk1_data($selector, new_data) {
    //var
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk1_range_map,
        chartRangeMin: 0,
        chartRangeMax: 1000
    });
    }

    function update_disk2_data($selector, new_data) {
    //home
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk2_range_map,
        chartRangeMin: 0,
        chartRangeMax: 2500
    });
    }

    function update_disk3_data($selector, new_data) {
    //slash
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk3_range_map,
        chartRangeMin: 0,
        chartRangeMax: 3000
    });
    }

    function update_disk45_data($selector, new_data) {
    //He1 
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk45_range_map,
        chartRangeMin: 0,
        chartRangeMax: 6000000
    });
    }

    function update_disk5_data($selector, new_data) {
    // He2
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk5_range_map,
        chartRangeMin: 0,
        chartRangeMax: 6000000
    });
    }

    function update_disk6_data($selector, new_data) {
    //int
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk6_range_map,
        chartRangeMin: 0,
        chartRangeMax: 3000
    });
    }

    function update_disk7_data($selector, new_data) {
    //NTU
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: disk7_range_map,
        chartRangeMin: 0,
        chartRangeMax: 250000
    });
    }

    function update_link_data($selector, new_data) {
    //for all link stuff in queue entries
    var array_string = $selector.attr('values');
    array_string = new_data;
    // $selector.attr('values', [1,1.5,4.5,6]).sparkline('html', {
        $selector.attr('values', array_string).sparkline('html', {
            type: 'bar',
            barWidth: 8,
        // zeroAxis: false,
        colorMap: link_range_map,
        chartRangeMin: 0,
        chartRangeMax: 100
    });
    }

    function updatehtml_hk(hk) {
        $.getJSON('/api/' + ip_db + '/hk/' + hk, function(data) {
            $('#power #p1_5v').html(data.hk.p1_5v);
            $('#power #p3_3v').html(data.hk.p3_3v);
            $('#power #p5v').html(data.hk.p5v);
            $('#power #p5sbv').html(data.hk.p5sbv);
            $('#power #p12v').html(data.hk.p12v);
            $('#power #p24v').html(data.hk.p24v);
            $('#power #ppvv').html(data.hk.ppvv);
            $('#power #n5v').html(data.hk.n5v);
            $('#power #n12v').html(data.hk.n12v);
            $('#power #iprf1v').html(data.hk.iprf1v);
            $('#power #iprf2v').html(data.hk.iprf2v);
            $('#power #p1_5i').html(data.hk.p1_5i);
            $('#power #p3_3i').html(data.hk.p3_3i);
            $('#power #p5i').html(data.hk.p5i);
            $('#power #p5sbi').html(data.hk.p5sbi);
            $('#power #p12i').html(data.hk.p12i);
            $('#power #p24i').html(data.hk.p24i);
            $('#power #ppvi').html(data.hk.ppvi);
            $('#power #n5i').html(data.hk.n5i);
            $('#power #n12i').html(data.hk.n12i);
            $('#power #iprf1i').html(data.hk.iprf1i);
            $('#power #iprf2i').html(data.hk.iprf2i);
            $('#power #bati').html(data.hk.bati);
            $('#aux #now').html(data.hk.now + " (" + timeConverter(data.hk.now) + ")");
            $('#aux #time').html(data.hk.time + " (" + timeConverter(data.hk.time) + ")");
            $('#aux #pressl').html(data.hk.pressl);
            $('#aux #pressh').html(data.hk.pressh);
            $('#aux #ssx-0').html(data.hk.ssx[0]);
            $('#aux #ssx-1').html(data.hk.ssx[1]);
            $('#aux #ssx-2').html(data.hk.ssx[2]);
            $('#aux #ssx-3').html(data.hk.ssx[3]);
            $('#aux #ssy-0').html(data.hk.ssy[0]);
            $('#aux #ssy-1').html(data.hk.ssy[1]);
            $('#aux #ssy-2').html(data.hk.ssy[2]);
            $('#aux #ssy-3').html(data.hk.ssy[3]);
            $('#aux #ssi-0').html(data.hk.ssi[0]);
            $('#aux #ssi-1').html(data.hk.ssi[1]);
            $('#aux #ssi-2').html(data.hk.ssi[2]);
            $('#aux #ssi-3').html(data.hk.ssi[3]);
            $('#aux #ssflag-0').html(data.hk.ssflag[0]);
            $('#aux #ssflag-1').html(data.hk.ssflag[1]);
            $('#aux #ssflag-2').html(data.hk.ssflag[2]);
            $('#aux #ssflag-3').html(data.hk.ssflag[3]);
            $('#aux #ssel-0').html(data.hk.ssel[0]);
            $('#aux #ssel-1').html(data.hk.ssel[1]);
            $('#aux #ssel-2').html(data.hk.ssel[2]);
            $('#aux #ssel-3').html(data.hk.ssel[3]);
            $('#aux #ssaz-0').html(data.hk.ssaz[0]);
            $('#aux #ssaz-1').html(data.hk.ssaz[1]);
            $('#aux #ssaz-2').html(data.hk.ssaz[2]);
            $('#aux #ssaz-3').html(data.hk.ssaz[3]);
            $('#aux #sst-0').html(data.hk.sst[0]);
            $('#aux #sst-1').html(data.hk.sst[1]);
            $('#aux #sst-2').html(data.hk.sst[2]);
            $('#aux #sst-3').html(data.hk.sst[3]);
            $('#aux #accx-0').html(data.hk.accx[0]);
            $('#aux #accy-0').html(data.hk.accy[0]);
            $('#aux #accz-0').html(data.hk.accz[0]);
            $('#aux #accx-1').html(data.hk.accx[1]);
            $('#aux #accy-1').html(data.hk.accy[1]);
            $('#aux #accz-1').html(data.hk.accz[1]);
            $('#aux #magx').html(data.hk.magx);
            $('#aux #magy').html(data.hk.magy);
            $('#aux #magz').html(data.hk.magz);
            var sbst1_name;
            sbst1_name = '#sbst1';
            update_sbst1_data($(sbst1_name), parseInt(data.hk.sbst1));
            var sbst2_name;
            sbst2_name = '#sbst2';
            update_sbst2_data($(sbst2_name), parseInt(data.hk.sbst2));

            var sbst5_name;
            sbst5_name = '#sbst5';
            update_sbst5_data($(sbst5_name), parseInt(data.hk.sbst5));
            var sbst6_name;
            sbst6_name = '#sbst6';
            update_sbst6_data($(sbst6_name), parseInt(data.hk.sbst6));
            var core1_name;
            core1_name = '#core1';
            update_core1_data($(core1_name), parseInt(data.hk.core1));
            var core2_name;
            core2_name = '#core2';
            update_core2_data($(core2_name), parseInt(data.hk.core2));
            var it_name;
            for (i = 0; i < 15; i++) {
                it_name = '#it-' + i;
                update_it_data($(it_name), parseInt(data.hk.it[i]));
            }
            var et_name;
            for (i = 0; i < 15; i++) {
                et_name = '#et-' + i;
                update_et_data($(et_name), parseInt(data.hk.et[i]));
            }
        });

}

function updatehtml_sshk(sshk) {
    if (!sshk) return;
    $.getJSON('/api/' + ip_db + '/sshk/' + sshk, function(data) {
        $('#aux #ssflag-4').html(data.sshk.ssflag[0]);
        $('#aux #ssflag-5').html(data.sshk.ssflag[1]);
        $('#aux #ssflag-6').html(data.sshk.ssflag[2]);
        $('#aux #ssflag-7').html(data.sshk.ssflag[3]);
        $('#aux #ssel-4').html(data.sshk.ssel[0]);
        $('#aux #ssel-5').html(data.sshk.ssel[1]);
        $('#aux #ssel-6').html(data.sshk.ssel[2]);
        $('#aux #ssel-7').html(data.sshk.ssel[3]);
        $('#aux #ssaz-4').html(data.sshk.ssaz[0]);
        $('#aux #ssaz-5').html(data.sshk.ssaz[1]);
        $('#aux #ssaz-6').html(data.sshk.ssaz[2]);
        $('#aux #ssaz-7').html(data.sshk.ssaz[3]);
    });
}

function updatehtml_mon(mon) {
    if (!mon) return;
    $.getJSON('/api/' + ip_db + '/mon/' + mon, function(data) {
        $('#montimes #now').html(data.mon.now + " (" + timeConverter(data.mon.now) + ")");
        $('#montimes #time').html(data.mon.time + " (" + timeConverter(data.mon.time) + ")");

        var linkcmdlos_name;
        linkcmdlos_name = '#linkcmdlos';
        update_link_data($(linkcmdlos_name), parseInt(data.mon.linkcmdlos));
        var linkcmdsip_name;
        linkcmdsip_name = '#linkcmdsip';
        update_link_data($(linkcmdsip_name), parseInt(data.mon.linkcmdsip));
        var linkhd_name;
        linkhd_name = '#linkhd';
        update_link_data($(linkhd_name), parseInt(data.mon.linkhd));
        var linkgps_name;
        linkgps_name = '#linkgps';
        update_link_data($(linkgps_name), parseInt(data.mon.linkgps));
        var linkhk_name;
        linkhk_name = '#linkhk';
        update_link_data($(linkhk_name), parseInt(data.mon.linkhk));
        var linkmon_name;
        linkmon_name = '#linkmon';
        update_link_data($(linkmon_name), parseInt(data.mon.linkmon));
        var linksurf_name;
        linksurf_name = '#linksurf';
        update_link_data($(linksurf_name), parseInt(data.mon.linksurf));
        var linkturf_name;
        linkturf_name = '#linkturf';
        update_link_data($(linkturf_name), parseInt(data.mon.linkturf));
        var linkped_name;
        linkped_name = '#linkped';
        update_link_data($(linkped_name), parseInt(data.mon.linkped));
        var linkev_name;
        for (i = 0; i < 10; i++) {
            linkev_name = '#linkev-' + i;
            update_link_data($(linkev_name), parseInt(data.mon.linkev[i]));
        }
        var disk_name;
        disk_name = '#disk-0';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[0]));
        var disk_name;
        disk_name = '#disk-1';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[1]));
        var disk_name;
        disk_name = '#disk-2';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[2]));
        var disk_name;
        disk_name = '#disk-3';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[3]));
        var disk_name;
        disk_name = '#disk-4';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[4]));
        var disk_name;
        disk_name = '#disk-5';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[5]));
        var disk_name;
        disk_name = '#disk-6';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[6]));
        var disk_name;
        disk_name = '#disk-7';
        update_disk0_data($(disk_name), parseInt(data.mon.disk[7]));
    });
}

function updatehtml_cmd(cmd) {
    if (!cmd) return;
    $.getJSON('/api/' + ip_db + '/cmd/' + cmd, function(data) {
        console.log('cmd');
        console.log(data.cmd);
        console.log(data.cmd.bytes);
        $('#cmd #now').html(data.cmd.now + " (" + timeConverter(data.cmd.now) + ")");
        $('#cmd #time').html(data.cmd.time + " (" + timeConverter(data.cmd.time) + ")");
        var length = data.cmd.bytes;
        var array = data.cmd.cmd;
        var last_command='';
        var antennas_off='';
        console.log(length);
        if (length >= 1){
            last_command += array[0].toString() + ' ';
        }

        if (length < 7){
           for (i = 1; i < length; i++) { 
                last_command += '0x' + array[i].toString(16) + ' ';
            } 
        }else{
             for (i = 1; i < 6; i++) { 
                last_command += '0x' + array[i].toString(16) + ' ';
            }
            for (i = 6; i < length; i++) { 
                antennas_off += '0x' + array[i].toString(16) + ' ';
            }
        }

       
        $('#cmd #last_command').html(last_command);
        $('#cmd #antennas_off').html(antennas_off);

    });
}

function updatehtml_adu5_pat(adu5_pat) {
    if (!adu5_pat) return;
    $.getJSON('/api/' + ip_db + '/adu5_pat/' + adu5_pat, function(data) {
        $('#gps #pat_gpstype').html(gpstype(data.pat.gpstype));
        if (gpstype(data.pat.gpstype) == 'adu5A'){        
           $('#gps #now_5A').html(data.pat.now);
           $('#gps #time_5A').html(data.pat.time);
           $('#gps #fullnow_5A').html(timeConverter(data.pat.now));
           $('#gps #fulltime_5A').html(timeConverter(data.pat.time));
           $('#gps #heading_5A').html(data.pat.heading);
           $('#gps #latitude_5A').html(data.pat.latitude);
           $('#gps #longitude_5A').html(data.pat.longitude);
           $('#gps #pitch_5A').html(data.pat.pitch);
           $('#gps #roll_5A').html(data.pat.roll);
           $('#gps #altitude_5A').html(data.pat.altitude);        
       }
       else if (gpstype(data.pat.gpstype) == 'adu5B'){
           $('#gps #now_5B').html(data.pat.now);
           $('#gps #time_5B').html(data.pat.time);
           $('#gps #fullnow_5B').html(timeConverter(data.pat.now));
           $('#gps #fulltime_5B').html(timeConverter(data.pat.time));
           $('#gps #heading_5B').html(data.pat.heading);
           $('#gps #latitude_5B').html(data.pat.latitude);
           $('#gps #longitude_5B').html(data.pat.longitude);
           $('#gps #pitch_5B').html(data.pat.pitch);
           $('#gps #roll_5B').html(data.pat.roll);
           $('#gps #altitude_5B').html(data.pat.altitude);
           $('#gps #numsats_5B').html(data.pat.numsats);
       }
   });
}

function updatehtml_adu5_vtg(adu5_vtg) {
    if (!adu5_vtg) return;
    $.getJSON('/api/' + ip_db + '/adu5_vtg/' + adu5_vtg, function(data) {
        $('#gps #vtg_gpstype').html(gpstype(data.vtg.gpstype));
        if (gpstype(data.vtg.gpstype) == 'adu5A'){
           $('#gps #vkph_5A').html(data.vtg.vkph);
           $('#gps #vkt_5A').html(data.vtg.vkt);
       }
       else if (gpstype(data.vtg.gpstype) == 'adu5B'){
           $('#gps #vkph_5B').html(data.vtg.vkph);
           $('#gps #vkt_5B').html(data.vtg.vkt);
       }
   });
}

function updatehtml_adu5_sat(adu5_sat) {
    if (!adu5_sat) return;
    $.getJSON('/api/' + ip_db + '/adu5_sat/' + adu5_sat, function(data) {
        $('#gps #sat_gpstype').html(gpstype(data.sat.gpstype));
        if (gpstype(data.sat.gpstype) == 'adu5A'){
           $('#gps #numsats_5A').html(data.sat.numsats[0]+', '+data.sat.numsats[1]+', '+data.sat.numsats[2]+', '+data.sat.numsats[3]);
       }
       else if (gpstype(data.sat.gpstype) == 'adu5B'){
           $('#gps #numsats_5B').html(data.sat.numsats[0]+', '+data.sat.numsats[1]+', '+data.sat.numsats[2]+', '+data.sat.numsats[3]);
       }
   });
}

function updatehtml_g12_pos(g12_pos){
   if (!g12_pos) return;
   $.getJSON('/api/' + ip_db + '/g12_pos/' + g12_pos, function(data){
       $('#gps #now_g12').html(data.pos.now);
       $('#gps #time_g12').html(data.pos.time);
       $('#gps #fullnow_g12').html(timeConverter(data.pos.now));
       $('#gps #fulltime_g12').html(timeConverter(data.pos.time));
       $('#gps #latitude_g12').html(data.pos.latitude);
       $('#gps #longitude_g12').html(data.pos.longitude);
       $('#gps #altitude_g12').html(data.pos.altitude);        
   });
}

function updatehtml_g12_sat(g12_sat){
   if (!g12_sat) return;
   $.getJSON('/api/' + ip_db + '/g12_sat/' + g12_sat, function(data){
       $('#gps #sat_gpstype').html(gpstype(data.sat.gpstype));        
       $('#gps #numsats_g12').html(data.sat.numsats); 
   });
}

$(document).ready(function() {
    $('#navbar_hk').parent().addClass("active");

    $.jqplot.config.enablePlugins = true;
    $("td[id]").click(function() {
        var column_name = $(this).attr('id');
        var table_name = $(this).closest('.ibox').attr('id');
        var name = table_name + '_' + column_name;

        // console.log($(this).attr('id'));
        // console.log($(this).closest('.ibox').attr('id'));
        if ($("#dialog_" + name).length) {
            $("#dialog_" + name).dialog('open');
            $("#dialog_" + name).find('input[id="reference_time"]').val(hk_times[i]);
        } else {
            var $newDialog = $('#dialog').clone();
            $newDialog.attr('id', 'dialog_' + name);
            $newDialog.removeClass('hide');
            $newDialog.attr('title', name);
            $newDialog.prepend('<div id="' + "plot_" + name + '"></div>');
            $newDialog.find('input[id="reference_time"]').val(hk_times[i]);
            $newDialog.dialog({
                width: 600,
                height: 500,
            });
            var line1 = [
            ['2008-09-30', 14]
            ];
            var plot1 = $.jqplot('plot_' + name, [line1], {
                title: 'double click to reset the zoom',
                axes: {
                    xaxis: {
                        renderer: $.jqplot.DateAxisRenderer,
                        rendererOptions: {
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer
                        },
                        tickOptions: {
                            // formatString: '%M:%S%#N ',
                            fontSize: '10pt',
                            fontFamily: 'Tahoma',
                        }
                    },
                    yaxis: {
                        rendererOptions: {
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer
                        },
                        tickOptions: {
                            fontSize: '10pt',
                            fontFamily: 'Tahoma',
                        }
                    }
                },
                series: [{
                    lineWidth: 2
                }],
                cursor: {
                    zoom: true,
                    looseZoom: true,
                    // showTooltip:true, 
                    followMouse: true,
                    showTooltipOutsideZoom: true,
                    constrainOutsideZoom: false
                }
            });

 $newDialog.dialog({
    resize: function(event, ui) {
        $("#plot_" + name).height(Math.max(100, $newDialog.height() - 120));
        plot1.replot({
            resetAxes: true,
        });
    }
});
}

$("#dialog_" + name).find('button[id="request"]').click(function() {
    console.log('click');
    var end_time = $newDialog.find('input[id="reference_time"]').val();
    var length = $newDialog.find('input[id="length"]').val();
    // console.log(end_time);
    // console.log(end_time - length);
    $.getJSON('/api/' + ip_db + '/history/' + table_name + '/' + column_name + '/' + (end_time - length) + '/' + end_time, function(data) {
        // console.log(data.data);
        plot1.replot({
            data: [data.data]
        });
    });
});

$("#dialog_" + name).find('button[id="request"]').trigger("click");
});



 $('.footable').footable();
 
 var hk_nbufs=[];
 var hk_nows=[];
 var hk_times=[];
 var sshk_nbufs=[];
 var sshk_nows=[];
 var sshk_times=[];
 var mon_nbufs=[];
 var mon_nows=[];
 var mon_times=[];
 var cmd_nbufs=[];
 var cmd_nows=[];
 var cmd_times=[];
 var adu5_pat_nbufs=[];
 var adu5_pat_nows=[];
 var adu5_pat_times=[];
 var adu5_vtg_nbufs=[];
 var adu5_vtg_nows=[];
 var adu5_vtg_times=[];
 var adu5_sat_nbufs=[];
 var adu5_sat_nows=[];
 var adu5_sat_times=[];
 var g12_pos_nbufs=[];
 var g12_pos_nows=[];
 var g12_pos_times=[];
 var g12_sat_nbufs=[];
 var g12_sat_nows=[];
 var g12_sat_times=[];
 var i=0;
 var j=0;
 var k=0;
 var l=0;
 var m=0;
 var n=0;
 var o=0;
 var p=0;
 var q=0;
 var connected = false;
    var sleep_interval = 2000 //by default, re-access the database every 2seconds to see if there are any new data comes in.



    function autoload(start_time) {
        $.getJSON('/api/' + ip_db + '/hk/nbufs/' + start_time, function(data) {
            new_length = data.hk_nbufs.length
            hk_nbufs = hk_nbufs.concat(data.hk_nbufs);
            hk_nows = hk_nows.concat(data.hk_nows);
            hk_times = hk_times.concat(data.hk_times);
            start_time = Math.max.apply(null, hk_times);
            $('#connect').removeClass('connect').removeClass('btn-primary').addClass('btn-warning');
            $('#connect').html('Disconnect');
            $('.chosen-select').attr("disabled", true).trigger("chosen:updated");
            // switchery.enable();
            connected = true;
            connect.ladda('stop');
        }).done(function() {
            setTimeout(function() {
                if (new_length) {
                    sleep_interval = 2000;
                } else {
                    sleep_interval = Math.min(sleep_interval * 1.2, 60000);
                }
                if (connected == true) {


                    autoload(start_time);
                }
            }, sleep_interval);
        });
console.log(start_time);
        $.getJSON('/api/' + ip_db + '/sshk/nbufs/' + start_time, function(data) {
            console.log(data);

            new_length = data.sshk_nbufs.length
            sshk_nbufs = sshk_nbufs.concat(data.sshk_nbufs);
            sshk_nows = sshk_nows.concat(data.sshk_nows);
            sshk_times = sshk_times.concat(data.sshk_times);
            // console.log(sshk_nbufs);
            // console.log(sshk_nows);
            // console.log(sshk_times);
        });
        $.getJSON('/api/' + ip_db + '/mon/nbufs/' + start_time, function(data) {
            
            new_length = data.mon_nbufs.length
            mon_nbufs = mon_nbufs.concat(data.mon_nbufs);
            mon_nows = mon_nows.concat(data.mon_nows);
            mon_times = mon_times.concat(data.mon_times);
        });
        $.getJSON('/api/' + ip_db + '/cmd/nbufs/' + start_time, function(data) {
            new_length = data.cmd_nbufs.length
            cmd_nbufs = cmd_nbufs.concat(data.cmd_nbufs);
            cmd_nows = cmd_nows.concat(data.cmd_nows);
            cmd_times = cmd_times.concat(data.cmd_times);
            // console.log(cmd_nbufs);
            // console.log(cmd_nows);
            // console.log(cmd_times);
        });
        $.getJSON('/api/' + ip_db + '/adu5_pat/nbufs/' + start_time, function(data) {
            new_length = data.adu5_pat_nbufs.length
            adu5_pat_nbufs = adu5_pat_nbufs.concat(data.adu5_pat_nbufs);
            adu5_pat_nows = adu5_pat_nows.concat(data.adu5_pat_nows);
            adu5_pat_times = adu5_pat_times.concat(data.adu5_pat_times);
        });
        $.getJSON('/api/' + ip_db + '/adu5_vtg/nbufs/' + start_time, function(data) {
            new_length = data.adu5_vtg_nbufs.length
            adu5_vtg_nbufs = adu5_vtg_nbufs.concat(data.adu5_vtg_nbufs);
            adu5_vtg_nows = adu5_vtg_nows.concat(data.adu5_vtg_nows);
            adu5_vtg_times = adu5_vtg_times.concat(data.adu5_vtg_times);
        });
        $.getJSON('/api/' + ip_db + '/adu5_sat/nbufs/' + start_time, function(data) {
            new_length = data.adu5_sat_nbufs.length
            adu5_sat_nbufs = adu5_sat_nbufs.concat(data.adu5_sat_nbufs);
            adu5_sat_nows = adu5_sat_nows.concat(data.adu5_sat_nows);
            adu5_sat_times = adu5_sat_times.concat(data.adu5_sat_times);
        });
        $.getJSON('/api/' + ip_db + '/g12_pos/nbufs/' + start_time, function(data){
           new_length=data.g12_pos_nbufs.length
           g12_pos_nbufs=g12_pos_nbufs.concat(data.g12_pos_nbufs);
           g12_pos_nows=g12_pos_nows.concat(data.g12_pos_nows);
           g12_pos_times=g12_pos_times.concat(data.g12_pos_times);
       });
        $.getJSON('/api/' + ip_db + '/g12_sat/nbufs/' + start_time, function(data){
           new_length=data.g12_sat_nbufs.length
           g12_sat_nbufs=g12_sat_nbufs.concat(data.g12_sat_nbufs);
           g12_sat_nows=g12_sat_nows.concat(data.g12_sat_nows);
           g12_sat_times=g12_sat_times.concat(data.g12_sat_times);                
       });
    }

    var connect = $('.ladda-button').ladda();
    $('#connect').click(function() {
        if ($(this).hasClass('connect')) {
            hk_nbufs = [];
            hk_nows = [];
            hk_times = [];
            sshk_nbufs = [];
            sshk_nows = [];
            sshk_times = [];
            mon_nbufs = [];
            mon_nows = [];
            mon_times = [];
            cmd_nbufs = [];
            cmd_nows = [];
            cmd_times = [];
            adu5_pat_nbufs = [];
            adu5_pat_nows = [];
            adu5_pat_times = [];
            adu5_vtg_nbufs = [];
            adu5_vtg_nows = [];
            adu5_vtg_times = [];
            adu5_sat_nbufs = [];
            adu5_sat_nows = [];
            adu5_sat_times = [];
            g12_pos_nbufs=[];
            g12_pos_nows=[];
            g12_pos_times=[];
            g12_sat_nbufs=[];
            g12_sat_nows=[];
            g12_sat_times=[];
            i = 0;
            j = 0;
            k = 0;
            l = 0;
            m = 0;
            n = 0;
            o=0;
            p=0;
            q=0;
            connect.ladda('start');
            $.ajax({
                url: '/api/connect/' + ip + '/' + db
            }).done(function(response) {
                if (response == 'success') {
                    autoload(0);
                    setTimeout(function(){
                        $('#first').click();
                    },3000);
                } else {
                    connect.ladda('stop');
                    swal({
                        title: 'Database not found!',
                        type: "warning",
                        timer: 3000,
                        showConfirmButton: true
                    });
                }
            });
        } else {
            hk_nbufs=[];
            hk_nows=[];
            hk_times=[];
            sshk_nbufs=[];
            sshk_nows=[];
            sshk_times=[];
            mon_nbufs=[];
            mon_nows=[];
            mon_times=[];
            cmd_nbufs = [];
            cmd_nows = [];
            cmd_times = [];
            adu5_pat_nbufs=[];
            adu5_pat_nows=[];
            adu5_pat_times=[];
            adu5_vtg_nbufs=[];
            adu5_vtg_nows=[];
            adu5_vtg_times=[];
            adu5_sat_nbufs=[];
            adu5_sat_nows=[];
            adu5_sat_times=[];             
            g12_pos_nbufs=[];
            g12_pos_nows=[];
            g12_pos_times=[];
            g12_sat_nbufs=[];
            g12_sat_nows=[];
            g12_sat_times=[];
            i=0;
            j=0;
            k=0;
            l=0;
            m=0;
            n=0;
            o=0;
            p=0;
            //otherwise, stop all the requests.
            $('#connect').addClass('connect').addClass('btn-primary').removeClass('btn-warning');
            $('#connect').html('Connect');
            $('.chosen-select').attr("disabled", false).trigger("chosen:updated");
            // if (switchery.isChecked()){
            //     $('.switchery').click();
            // };
            // switchery.disable();              
            connected = false;
        }
    });
 //update all html with hk index i;
function updatehtml_all (i) {
        updatehtml_hk(hk_nbufs[i]);
        j=mon_nows.indexOf(hk_nows[i]);
        if (j!=-1) updatehtml_mon(mon_nbufs[j]);
        k=adu5_pat_nows.indexOf(hk_nows[i]);
        if (k!=-1) updatehtml_adu5_pat(adu5_pat_nbufs[k]);
        l=adu5_vtg_nows.indexOf(hk_nows[i]);
        if (l!=-1) updatehtml_adu5_vtg(adu5_vtg_nbufs[l]);
        m=adu5_sat_nows.indexOf(hk_nows[i]);
        if (m!=-1) updatehtml_adu5_sat(adu5_sat_nbufs[m]);
        n=sshk_nows.indexOf(hk_nows[i]);
        if (n!=-1) updatehtml_sshk(sshk_nbufs[n]);
        o=g12_pos_nows.indexOf(hk_nows[i]);
        if (o!=-1) updatehtml_g12_pos(g12_pos_nbufs[o]);
        p=g12_sat_nows.indexOf(hk_nows[i]);
        if (p!=-1) updatehtml_g12_sat(g12_sat_nbufs[p]);
        q=cmd_nows.indexOf(hk_nows[i]);
        if (q!=-1) updatehtml_cmd(cmd_nbufs[q]);    
}

 $('#next').click( function(){
    if (sync_on){
       if (i<hk_nbufs.length-1) {
           i=i+1;
           updatehtml_all(i);
       };
    }else{
        if (i<hk_nbufs.length-1)        {i=i+1; updatehtml_hk(hk_nbufs[i]);}
        if (j<mon_nbufs.length-1)       {j=j+1; updatehtml_mon(mon_nbufs[j]);}
        if (k<adu5_pat_nbufs.length-1)  {k=k+1; updatehtml_adu5_pat(adu5_pat_nbufs[k]);}
        if (l<adu5_vtg_nbufs.length-1)  {l=l+1; updatehtml_adu5_vtg(adu5_vtg_nbufs[l]);}
        if (m<adu5_sat_nbufs.length-1)  {m=m+1; updatehtml_adu5_sat(adu5_sat_nbufs[m]);}
        if (n<sshk_nbufs.length-1)      {n=n+1; updatehtml_sshk(sshk_nbufs[n]);}
        if (o<g12_pos_nbufs.length-1)   {o=o+1; updatehtml_g12_pos(g12_pos_nbufs[o]);}
        if (p<g12_sat_nbufs.length-1)   {p=p+1; updatehtml_g12_sat(g12_sat_nbufs[p]);}
        if (q<cmd_nbufs.length-1)       {q=q+1; updatehtml_cmd(cmd_nbufs[q]);}
    }
});
 $('#prev').click( function(){
    if (sync_on){
       if (i>0) {
           i=i-1;
           updatehtml_all(i);
       };
    }else{
        if (i>0)  {i=i-1; updatehtml_hk(hk_nbufs[i]);}
        if (j>0)  {j=j-1; updatehtml_mon(mon_nbufs[j]);}
        if (k>0)  {k=k-1; updatehtml_adu5_pat(adu5_pat_nbufs[k]);}
        if (l>0)  {l=l-1; updatehtml_adu5_vtg(adu5_vtg_nbufs[l]);}
        if (m>0)  {m=m-1; updatehtml_adu5_sat(adu5_sat_nbufs[m]);}
        if (n>0)  {n=n-1; updatehtml_sshk(sshk_nbufs[n]);}
        if (o>0)  {o=o-1; updatehtml_g12_pos(g12_pos_nbufs[o]);}
        if (p>0)  {p=p-1; updatehtml_g12_sat(g12_sat_nbufs[p]);}
        if (q>0)  {q=q-1; updatehtml_cmd(cmd_nbufs[q]);}
    }
});
 $('#first').click( function(){
    if (sync_on){
        i=0;
        updatehtml_all(i);
    }else{
        {i=0; updatehtml_hk(hk_nbufs[i]);}
        {j=0; updatehtml_mon(mon_nbufs[j]);}
        {k=0; updatehtml_adu5_pat(adu5_pat_nbufs[k]);}
        {l=0; updatehtml_adu5_vtg(adu5_vtg_nbufs[l]);}
        {m=0; updatehtml_adu5_sat(adu5_sat_nbufs[m]);}
        {n=0; updatehtml_sshk(sshk_nbufs[n]);}
        {o=0; updatehtml_g12_pos(g12_pos_nbufs[o]);}
        {p=0; updatehtml_g12_sat(g12_sat_nbufs[p]);}
        {q=0; updatehtml_cmd(cmd_nbufs[q]);}
    }
});
 $('#last').click( function(){
    if (sync_on){
        i=hk_nbufs.length-1;
        updatehtml_all(i);
    }else{
        {i=hk_nbufs.length-1; updatehtml_hk(hk_nbufs[i]);}
        {j=mon_nbufs.length-1; updatehtml_mon(mon_nbufs[j]);}
        {k=adu5_pat_nbufs.length-1; updatehtml_adu5_pat(adu5_pat_nbufs[k]);}
        {l=adu5_vtg_nbufs.length-1; updatehtml_adu5_vtg(adu5_vtg_nbufs[l]);}
        {m=adu5_sat_nbufs.length-1; updatehtml_adu5_sat(adu5_sat_nbufs[m]);}
        {n=sshk_nbufs.length-1; updatehtml_sshk(sshk_nbufs[n]);}
        {o=g12_pos_nbufs.length-1; updatehtml_g12_pos(g12_pos_nbufs[o]);}
        {p=g12_sat_nbufs.length-1; updatehtml_g12_sat(g12_sat_nbufs[p]);}
        {q=cmd_nbufs.length-1; updatehtml_cmd(cmd_nbufs[q]);}
    }
});
 var sync_checkbox = $('#sync_checkbox')[0];
 var switchery_sync = new Switchery(sync_checkbox, { color: '#1AB394' });
    sync_checkbox.onchange = function() {
        if (sync_checkbox.checked) {
            sync_on = true;
           
        } else {
            sync_on = false;
        };
    };
 var auto_checkbox = $('#auto_checkbox')[0];
 var switchery_auto = new Switchery(auto_checkbox, { color: '#1AB394' });
  console.log(auto_checkbox);

    // switchery.disable();
    var myInterval;
    auto_checkbox.onchange = function() {
        if (auto_checkbox.checked) {
            myInterval = setInterval(function() {
                if (sync_on){
                   if (i<hk_nbufs.length-1) {
                       i=i+1;
                       updatehtml_all(i);
                   };
                }else{
                    if (i<hk_nbufs.length-1)        {i=i+1; updatehtml_hk(hk_nbufs[i]);}
                    if (j<mon_nbufs.length-1)       {j=j+1; updatehtml_mon(mon_nbufs[j]);}
                    if (k<adu5_pat_nbufs.length-1)  {k=k+1; updatehtml_adu5_pat(adu5_pat_nbufs[k]);}
                    if (l<adu5_vtg_nbufs.length-1)  {l=l+1; updatehtml_adu5_vtg(adu5_vtg_nbufs[l]);}
                    if (m<adu5_sat_nbufs.length-1)  {m=m+1; updatehtml_adu5_sat(adu5_sat_nbufs[m]);}
                    if (n<sshk_nbufs.length-1)      {n=n+1; updatehtml_sshk(sshk_nbufs[n]);}
                    if (o<g12_pos_nbufs.length-1)   {o=o+1; updatehtml_g12_pos(g12_pos_nbufs[o]);}
                    if (p<g12_sat_nbufs.length-1)   {p=p+1; updatehtml_g12_sat(g12_sat_nbufs[p]);}
                    if (q<cmd_nbufs.length-1)       {q=q+1; updatehtml_cmd(cmd_nbufs[q]);}
                }
            }, 1000);
    } else {
        clearInterval(myInterval);
    };
};

$('#goto').click( function(){
   var keywords=parseInt($('#keywords').val());
   // console.log(keywords);
   if (sync_on){
        var index=hk_times.indexOf(keywords);
        if (index!=-1 && keywords){
           i=index;
           updatehtml_all(i);
        }else{
            swal({  title: 'HK Data not found!', type: "warning", timer: 3000, showConfirmButton: true});
        }
   }else{
        var message = '';
        var index=hk_times.indexOf(keywords);       if(index!=-1 && keywords) { i=index; updatehtml_hk(hk_nbufs[i]); message += 'HK ';}
        var index=mon_times.indexOf(keywords);      if(index!=-1 && keywords) { j=index; updatehtml_mon(mon_nbufs[j]); message += 'MON ';}
        var index=adu5_pat_times.indexOf(keywords); if(index!=-1 && keywords) { k=index; updatehtml_adu5_pat(adu5_pat_nbufs[k]); message += 'ADU5_PAT ';}
        var index=adu5_vtg_times.indexOf(keywords); if(index!=-1 && keywords) { l=index; updatehtml_adu5_vtg(adu5_vtg_nbufs[l]); message += 'ADU5_VTG ';}
        var index=adu5_sat_times.indexOf(keywords); if(index!=-1 && keywords) { m=index; updatehtml_adu5_sat(adu5_sat_nbufs[m]); message += 'ADU5_SAT ';}
        var index=sshk_times.indexOf(keywords);     if(index!=-1 && keywords) { n=index; updatehtml_sshk(sshk_nbufs[n]); message += 'SSHK ';}
        var index=g12_pos_times.indexOf(keywords);  if(index!=-1 && keywords) { o=index; updatehtml_g12_pos(g12_pos_nbufs[o]); message += 'G12_POS ';}
        var index=g12_sat_times.indexOf(keywords);  if(index!=-1 && keywords) { p=index; updatehtml_g12_sat(g12_sat_nbufs[p]); message += 'G12_SAT ';}
        var index=cmd_times.indexOf(keywords);      if(index!=-1 && keywords) { q=index; updatehtml_cmd(cmd_nbufs[q]); message += 'CMD ';}
        if (message == ''){
            swal({  title: 'No matched time found!', type: "warning", timer: 3000, showConfirmButton: true});
        }else{
            swal({  title: 'Matched '+message + 'time are found!', type: "success", timer: 3000, showConfirmButton: true});
        }

   }
});
});
 </script>
 {% endblock %}